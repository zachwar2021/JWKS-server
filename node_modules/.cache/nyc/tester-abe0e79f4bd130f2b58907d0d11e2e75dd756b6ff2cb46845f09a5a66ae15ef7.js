const request = require('supertest');
const assert = require('assert');
const app = require('./server'); // Replace with the actual filename of your main app file

describe('Testing Express App Endpoints', () => {
  it('should return JWKS when accessing /.well-known/jwks.json', (done) => {
    request(app)
      .get('/.well-known/jwks.json')
      .expect('Content-Type', /json/)
      .expect(200)
      .end((err, res) => {
        if (err) return done(err);
        assert(res.body.keys && res.body.keys.length === 1, 'Invalid JWKS response');
        done();
      });
  });

  it('should return a valid token when accessing /auth with POST request', (done) => {
    request(app)
      .post('/auth')
      .expect('Content-Type', /json/)
      .expect(200)
      .end((err, res) => {
        if (err) return done(err);
        assert(res.body.token, 'Token not found in the response');
        done();
      });
  });

  // Add more test cases for other endpoints as needed

  after((done) => {
    // You can perform any cleanup or closing operations here
    app.close(() => {
        console.log('Server closed');
        done();
  });
});
